// é–¢æ•°åž‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ä½œæˆ

// === åŸºæœ¬çš„ãªææ–™ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€  ===
const Ingredients = {
MILK: â€˜milkâ€™,
CREAM: â€˜creamâ€™,
SUGAR: â€˜sugarâ€™,
VANILLA: â€˜vanillaâ€™,
CHOCOLATE: â€˜chocolateâ€™,
STRAWBERRY: â€˜strawberryâ€™,
MATCHA: â€˜matchaâ€™,
SALT: â€˜saltâ€™,
EGGS: â€˜eggsâ€™
};

const Flavors = {
VANILLA: â€˜vanillaâ€™,
CHOCOLATE: â€˜chocolateâ€™,
STRAWBERRY: â€˜strawberryâ€™,
MATCHA: â€˜matchaâ€™
};

// === ç´”ç²‹é–¢æ•°ç¾¤ ===

// åŸºæœ¬ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ç´”ç²‹é–¢æ•°
const createBase = (milk, cream, sugar) => ({
ingredients: [milk, cream, sugar],
texture: â€˜liquidâ€™,
temperature: 20, // å®¤æ¸©
sweetness: sugar * 0.1,
richness: cream * 0.15
});

// ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã‚’è¿½åŠ ã™ã‚‹ç´”ç²‹é–¢æ•°
const addFlavor = (base, flavor, amount = 1) => ({
â€¦base,
ingredients: [â€¦base.ingredients, { flavor, amount }],
flavor: flavor,
intensity: amount
});

// åµã‚’è¿½åŠ ã—ã¦ã‚«ã‚¹ã‚¿ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ç´”ç²‹é–¢æ•°
const addEggs = (base, eggCount) => ({
â€¦base,
ingredients: [â€¦base.ingredients, { ingredient: Ingredients.EGGS, count: eggCount }],
type: â€˜custardâ€™,
richness: base.richness + eggCount * 0.2
});

// åŠ ç†±å‡¦ç†ã™ã‚‹ç´”ç²‹é–¢æ•°
const heat = (mixture, temperature) => ({
â€¦mixture,
temperature: temperature,
texture: temperature > 70 ? â€˜custardâ€™ : mixture.texture,
cooked: temperature > 70
});

// å†·å´ã™ã‚‹ç´”ç²‹é–¢æ•°
const cool = (mixture, targetTemp) => ({
â€¦mixture,
temperature: targetTemp,
ready_for_churning: targetTemp <= 4
});

// ãƒãƒ£ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆæ”ªæ‹Œï¼‰ã™ã‚‹ç´”ç²‹é–¢æ•°
const churn = (cooledMixture, duration) => {
if (!cooledMixture.ready_for_churning) {
throw new Error(â€˜æ··åˆç‰©ãŒååˆ†ã«å†·ãˆã¦ã„ã¾ã›ã‚“â€™);
}

return {
â€¦cooledMixture,
texture: â€˜creamyâ€™,
volume: cooledMixture.volume ? cooledMixture.volume * 1.5 : 100,
air_incorporation: duration * 0.1,
churned: true
};
};

// å†·å‡ã™ã‚‹ç´”ç²‹é–¢æ•°
const freeze = (churned, hours) => ({
â€¦churned,
temperature: -18,
texture: hours >= 4 ? â€˜firmâ€™ : â€˜soft-serveâ€™,
frozen: true,
serving_ready: hours >= 4
});

// ãƒˆãƒƒãƒ”ãƒ³ã‚°ã‚’è¿½åŠ ã™ã‚‹ç´”ç²‹é–¢æ•°
const addToppings = (icecream, toppings) => ({
â€¦icecream,
toppings: [â€¦(icecream.toppings || []), â€¦toppings],
presentation_ready: true
});

// === é«˜éšŽé–¢æ•°ã¨ã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚¿ãƒ¼ ===

// ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°ï¼ˆé–¢æ•°åˆæˆï¼‰
const pipe = (â€¦functions) => (initialValue) =>
functions.reduce((value, func) => func(value), initialValue);

// éƒ¨åˆ†é©ç”¨ã®ãŸã‚ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
const curry = (func) => (â€¦args) =>
args.length >= func.length
? func(â€¦args)
: (â€¦nextArgs) => curry(func)(â€¦args, â€¦nextArgs);

// === ãƒ¬ã‚·ãƒ”é–¢æ•°ç¾¤ ===

// ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ãƒ¬ã‚·ãƒ”
const makeVanillaIceCream = pipe(
(ingredients) => createBase(ingredients.milk, ingredients.cream, ingredients.sugar),
(base) => addFlavor(base, Flavors.VANILLA, 2),
(flavored) => addEggs(flavored, 3),
(custard) => heat(custard, 75),
(heated) => cool(heated, 4),
(cooled) => churn(cooled, 20),
(churned) => freeze(churned, 6)
);

// ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ãƒ¬ã‚·ãƒ”
const makeChocolateIceCream = pipe(
(ingredients) => createBase(ingredients.milk, ingredients.cream, ingredients.sugar),
(base) => addFlavor(base, Flavors.CHOCOLATE, 3),
(flavored) => addEggs(flavored, 4),
(custard) => heat(custard, 75),
(heated) => cool(heated, 4),
(cooled) => churn(cooled, 25),
(churned) => freeze(churned, 8)
);

// æŠ¹èŒ¶ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ãƒ¬ã‚·ãƒ”
const makeMatchaIceCream = pipe(
(ingredients) => createBase(ingredients.milk, ingredients.cream, ingredients.sugar),
(base) => addFlavor(base, Flavors.MATCHA, 2),
(flavored) => addEggs(flavored, 2),
(custard) => heat(custard, 70),
(heated) => cool(heated, 4),
(cooled) => churn(cooled, 18),
(churned) => freeze(churned, 5)
);

// === ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼é–¢æ•° ===
const IceCreamFactory = {
create: (recipe, ingredients, toppings = []) => {
const icecream = recipe(ingredients);
return toppings.length > 0 ? addToppings(icecream, toppings) : icecream;
}
};

// === å“è³ªãƒã‚§ãƒƒã‚¯é–¢æ•° ===
const qualityCheck = (icecream) => ({
â€¦icecream,
quality_score: calculateQualityScore(icecream),
quality_passed: icecream.serving_ready && icecream.frozen && icecream.texture === â€˜firmâ€™
});

const calculateQualityScore = (icecream) => {
let score = 0;
if (icecream.richness > 0.5) score += 25;
if (icecream.sweetness > 0.3 && icecream.sweetness < 0.8) score += 25;
if (icecream.texture === â€˜firmâ€™) score += 25;
if (icecream.temperature <= -15) score += 25;
return score;
};

// === ä½¿ç”¨ä¾‹ ===

// ææ–™ã®æº–å‚™
const ingredients = {
milk: 500,    // ml
cream: 250,   // ml
sugar: 100    // g
};

// ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã‚’ä½œæˆ
console.log(â€˜ðŸ¦ ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ä½œæˆä¸­â€¦â€™);
const vanillaIceCream = IceCreamFactory.create(
makeVanillaIceCream,
ingredients,
[â€˜ãƒãƒ§ã‚³ãƒãƒƒãƒ—â€™, â€˜ãƒŠãƒƒãƒ„â€™]
);
const vanillaQuality = qualityCheck(vanillaIceCream);

console.log(â€˜âœ… ãƒãƒ‹ãƒ©ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ å®Œæˆï¼â€™);
console.log(â€˜ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼:â€™, vanillaQuality.flavor);
console.log(â€˜é£Ÿæ„Ÿ:â€™, vanillaQuality.texture);
console.log(â€˜å“è³ªã‚¹ã‚³ã‚¢:â€™, vanillaQuality.quality_score + â€˜/100â€™);
console.log(â€˜ãƒˆãƒƒãƒ”ãƒ³ã‚°:â€™, vanillaQuality.toppings);
console.log(â€™â€™);

// ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã‚’ä½œæˆ
console.log(â€˜ðŸ« ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ä½œæˆä¸­â€¦â€™);
const chocolateIceCream = IceCreamFactory.create(
makeChocolateIceCream,
ingredients,
[â€˜ãƒ›ã‚¤ãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ â€™]
);
const chocolateQuality = qualityCheck(chocolateIceCream);

console.log(â€˜âœ… ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ å®Œæˆï¼â€™);
console.log(â€˜ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼:â€™, chocolateQuality.flavor);
console.log(â€˜é£Ÿæ„Ÿ:â€™, chocolateQuality.texture);
console.log(â€˜å“è³ªã‚¹ã‚³ã‚¢:â€™, chocolateQuality.quality_score + â€˜/100â€™);
console.log(â€™â€™);

// æŠ¹èŒ¶ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ã‚’ä½œæˆ
console.log(â€˜ðŸµ æŠ¹èŒ¶ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ä½œæˆä¸­â€¦â€™);
const matchaIceCream = IceCreamFactory.create(
makeMatchaIceCream,
ingredients,
[â€˜ã‚ã‚“ã“â€™, â€˜ç™½çŽ‰â€™]
);
const matchaQuality = qualityCheck(matchaIceCream);

console.log(â€˜âœ… æŠ¹èŒ¶ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ å®Œæˆï¼â€™);
console.log(â€˜ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼:â€™, matchaQuality.flavor);
console.log(â€˜é£Ÿæ„Ÿ:â€™, matchaQuality.texture);
console.log(â€˜å“è³ªã‚¹ã‚³ã‚¢:â€™, matchaQuality.quality_score + â€˜/100â€™);
console.log(â€˜ãƒˆãƒƒãƒ”ãƒ³ã‚°:â€™, matchaQuality.toppings);

// === é–¢æ•°åž‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åˆ©ç‚¹ã‚’ç¤ºã™ãƒ†ã‚¹ãƒˆ ===
console.log(â€™\nðŸ§ª é–¢æ•°åž‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åˆ©ç‚¹ãƒ‡ãƒ¢:â€™);

// 1. ç´”ç²‹é–¢æ•° - åŒã˜å…¥åŠ›ã¯å¸¸ã«åŒã˜å‡ºåŠ›
const base1 = createBase(500, 250, 100);
const base2 = createBase(500, 250, 100);
console.log(â€˜ç´”ç²‹é–¢æ•°ãƒ†ã‚¹ãƒˆ - åŒã˜çµæžœ:â€™, JSON.stringify(base1) === JSON.stringify(base2));

// 2. ä¸å¤‰æ€§ - å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å¤‰æ›´ã•ã‚Œãªã„
const originalBase = createBase(500, 250, 100);
const flavoredBase = addFlavor(originalBase, Flavors.VANILLA);
console.log(â€˜ä¸å¤‰æ€§ãƒ†ã‚¹ãƒˆ - å…ƒã®ãƒ™ãƒ¼ã‚¹ã¯å¤‰æ›´ã•ã‚Œã¦ã„ãªã„:â€™,
!originalBase.hasOwnProperty(â€˜flavorâ€™) && flavoredBase.hasOwnProperty(â€˜flavorâ€™));

// 3. é–¢æ•°åˆæˆ - è¤‡é›‘ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å°ã•ãªé–¢æ•°ã®çµ„ã¿åˆã‚ã›ã§è¡¨ç¾
console.log(â€˜é–¢æ•°åˆæˆãƒ†ã‚¹ãƒˆ - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ä½œæˆå®Œäº†â€™);